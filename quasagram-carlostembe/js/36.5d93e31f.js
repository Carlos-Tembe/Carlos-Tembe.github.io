"use strict";(globalThis["webpackChunkquasagram"]=globalThis["webpackChunkquasagram"]||[]).push([[36],{6036:(t,a,o)=>{o.r(a),o.d(a,{default:()=>I});var e=o(9835),i=o(1957);const n={class:"camera-frame q-pa-md"},s={ref:"video",class:"full-width",autoplay:"",playsinline:""},l={ref:"canvas",class:"full-width",height:"240"},r={class:"text-center q-pa-md"},d={class:"row justify-center q-ma-md"},c={class:"row justify-center q-ma-md"},p={class:"row justify-center q-mt-lg"};function h(t,a,o,h,u,g){const m=(0,e.up)("q-btn"),C=(0,e.up)("q-icon"),w=(0,e.up)("q-file"),v=(0,e.up)("q-input"),f=(0,e.up)("q-page");return(0,e.wg)(),(0,e.j4)(f,{class:"constrain-more q-pa-md"},{default:(0,e.w5)((()=>[(0,e._)("div",n,[(0,e.wy)((0,e._)("video",s,null,512),[[i.F8,!u.imageCaptured]]),(0,e.wy)((0,e._)("canvas",l,null,512),[[i.F8,u.imageCaptured]])]),(0,e._)("div",r,[u.hasCameraSupport?((0,e.wg)(),(0,e.j4)(m,{key:0,onClick:g.captureImage,round:"",disable:u.imageCaptured,color:"grey-10",icon:"eva-camera",size:"lg"},null,8,["onClick","disable"])):((0,e.wg)(),(0,e.j4)(w,{key:1,outlined:"",onInput:g.captureImageFallback,modelValue:u.imageUpload,"onUpdate:modelValue":a[0]||(a[0]=t=>u.imageUpload=t),label:"Choose an image",accept:"image/*"},{prepend:(0,e.w5)((()=>[(0,e.Wm)(C,{name:"eva-attach-outline"})])),_:1},8,["onInput","modelValue"])),(0,e._)("div",d,[(0,e.Wm)(v,{modelValue:u.post.caption,"onUpdate:modelValue":a[1]||(a[1]=t=>u.post.caption=t),label:"Caption *",class:"col col-sm-6",dense:""},null,8,["modelValue"])]),(0,e._)("div",c,[(0,e.Wm)(v,{modelValue:u.post.location,"onUpdate:modelValue":a[2]||(a[2]=t=>u.post.location=t),loading:u.locationLoading,label:"Location",class:"col col-sm-6",dense:""},{append:(0,e.w5)((()=>[!u.locationLoading&&g.locationSupported?((0,e.wg)(),(0,e.j4)(m,{key:0,round:"",dense:"",flat:"",icon:"eva-navigation-2-outline",onClick:g.getLocation},null,8,["onClick"])):(0,e.kq)("",!0)])),_:1},8,["modelValue","loading"])]),(0,e._)("div",p,[(0,e.Wm)(m,{onClick:a[3]||(a[3]=t=>g.addPost()),disable:!u.post.caption||!u.post.photo,unelevated:"",rounded:"",color:"primary",label:"POST IMAGE"},null,8,["disable"])])])])),_:1})}o(6204),o(5231),o(3075),o(548),o(2079),o(8218),o(6046),o(9665);var u=o(796),g=o(4376);o(8419);const m={name:"PageCamera",data(){return{post:{id:(0,u.Z)(),caption:"",location:"",photo:null,date:g.ZP.formatDate(Date.now(),"MMMM D h:mmA")},imageCaptured:!1,imageUpload:[],hasCameraSupport:!0,locationLoading:!1}},computed:{locationSupported(){if(!("geolocation"in navigator))return!1}},methods:{initCamera(){navigator.mediaDevices.getUserMedia({video:!0}).then((t=>{this.$refs.video.srcObject=t})).catch((t=>{this.hasCameraSupport=!1}))},captureImage(){let t=this.$refs.video,a=this.$refs.canvas;a.width=t.getBoundingClientRect().width,a.height=t.getBoundingClientRect().height;let o=a.getContext("2d");o.drawImage(t,0,0,a.width,a.height),this.imageCaptured=!0,this.post.photo=this.dataURItoBlob(a.toDataURL()),this.disableCamera()},captureImageFallback(t){this.post.photo=t;let a=this.$refs.canvas,o=a.getContext("2d");var e=new FileReader;e.onload=t=>{var e=new Image;e.onload=()=>{a.width=e.width,a.height=e.height,o.drawImage(e,0,0),this.imageCaptured=!0},e.src=t.target.result}},disableCamera(){this.$refs.video.srcObject.getVideoTracks().forEach((t=>{t.stop()}))},dataURItoBlob(t){for(var a=atob(t.split(",")[1]),o=t.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(a.length),i=new Uint8Array(e),n=0;n<a.length;n++)i[n]=a.charCodeAt(n);var s=new Blob([e],{type:o});return s},getLocation(){this.locationLoading=!0,navigator.geolocation.getCurrentPosition((t=>{this.getCityAndCountry(t),console.log(t)}),(t=>{this.locationError()}),{timeout:7e3})},getCityAndCountry(t){let a=`https://geocode.xyz/${t.coords.latitude},${t.coords.longitude}?json=1`;this.$axios.get(a).then((t=>{this.locationError(),this.locationSuccess(t)})).catch((t=>{this.locationError()}))},locationError(){this.$q.dialog({title:"Alert",message:"Could not find your location"}),this.locationLoading=!1},locationSuccess(t){this.post.location=t.data.city,t.data.country&&(this.post.location+=`, ${t.data.country}`),this.locationLoading=!1},addPost(){this.$q.loading.show();let t=new FormData;t.append("id",this.post.id),t.append("caption",this.post.caption),t.append("location",this.post.location),t.append("date",this.post.date),t.append("file",this.post.photo,this.post.id+".png"),this.$axios.post("http://localhost:3000/createPost",t).then((t=>{console.log("response: ",t),this.$router.push("/"),$q.notify({message:"Post created!",actions:[{label:"Dismiss",color:"white"}]}),this.$q.loading.hide()})).catch((t=>{this.$q.dialog({title:"Error",message:"Sorry, could not creat the post!"}),this.locationLoading=!1}))}},mounted(){this.initCamera()},beforeUnmount(){this.hasCameraSupport&&this.disableCamera()}};var C=o(1639),w=o(9885),v=o(4455),f=o(1527),b=o(2857),y=o(4152),q=o(9984),k=o.n(q);const $=(0,C.Z)(m,[["render",h]]),I=$;k()(m,"components",{QPage:w.Z,QBtn:v.Z,QFile:f.Z,QIcon:b.Z,QInput:y.Z})}}]);